# Add Characters Page

## Purpose

The Add Characters page is the ingestion entry point for the learning queue.
It lets admins add one or many Chinese characters into local storage so they become available in:

- All Characters list
- Due Review / Flashcard / Fill-test flows
- Content Admin target discovery

## Entry Point

- Route: `/words/add`
- UI host: `WordsWorkspace` with `page="add"`

## Rules

1. Input accepts free text, but only Hanzi characters are extracted.
2. Non-Hanzi symbols (letters, punctuation, numbers, emoji) are ignored.
3. Multi-character strings are split into individual Hanzi characters.
4. Duplicate characters inside the same submission are removed.
5. Existing characters already in DB are skipped.
6. New records are initialized as "new/unreviewed" (`repetitions=0`, `nextReviewAt=0`, no fill-test).
7. A bilingual status message is shown after submit:
   - nothing added
   - added all
   - added some and skipped existing

## Processing Flow

1. User submits form.
2. Input is trimmed; empty input is rejected with notice.
3. `extractUniqueHanzi(...)` parses unique Hanzi list from input.
4. DB query fetches already-existing Hanzi entries.
5. New `Word` objects are created for remaining Hanzi.
6. `bulkAdd(...)` writes new words.
7. UI refreshes words + due words via `refreshAll()`.

## Data Initialization

Each inserted `Word` is initialized with:

- `id`: generated by `makeId()`
- `hanzi`: single character
- `createdAt`: current timestamp + index offset
- `repetitions`: `0`
- `intervalDays`: `0`
- `ease`: `21`
- `nextReviewAt`: `0`
- `reviewCount`: `0`
- `testCount`: `0`
- `fillTest`: `undefined`

## Risks

1. No server sync: data is local IndexedDB only.
2. Check-then-add is not atomic across tabs/sessions:
   if two submissions race, same Hanzi can be inserted twice because `hanzi` is indexed but not unique.
3. Add flow does not auto-generate flashcard/admin content; Content Admin remains a separate step.
4. Input preserves only the first-level Hanzi extraction; semantic grouping is intentionally not supported.
